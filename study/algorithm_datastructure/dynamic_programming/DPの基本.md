# DP の基本

DP を数学的に端的に言うと，「漸化式を書いて問題を解きましょう」ということ．

## DP

- 「状態の遷移」を扱う（部分問題から全体へ）
- 「一つ前の状態までの最適な状態は分かっている」という仮定を置くと（置けるならば），その状態を遷移させていけば最後に最適解が求められる
- **`dp[i]` には i 番目までの（最適な）探索過程がまとめられている**．
- 探索過程をメモしていく．
- `dp[i]` が前の状態の何に依存してるかを考える．
- 終了状態から見ていくとよいこともある．

## DP の実装順序

準備

1．DP テーブルの用意
2．全体を「DP の種類に応じた初期値」で初期化（最小化，最大化問題など）
3．初期条件を入力

計算

4．ループを回す（状態を遷移させる）
5．テーブルから解を得て出力

## DP の重要な仮定

「一つ前の状態までの最適な状態は分かっている」という仮定を置くと（置けるならば），その状態を遷移させていけば最後に最適解が求められる．

## DP のポイント

DP のポイントは以下の通り．

- `dp[i]` には，i 番目までの探索過程（最適な状態）が格納されている（部分構造最適性の利用）
- ノード from からノード to への遷移を行うときは，`dp[from]` の更新は完了している
- つまり状態は戻らない

## DP の計算量

計算量は [tex: O(V+E)]．[tex: V] はノード数，[tex: E] はエッジ数（状態の遷移の回数と考えれば良い）．

> 注意点として O(E)O(E) ではなく O(V+E)O(V+E) としています。仮にエッジがまったくなかったとしても、ノード全体を見回す処理を書くことになりますので (メモ化再帰であればそうとは限らないですが...)、念のために O(V+E)O(V+E) と書いています。実際上はほとんどの場合で O(E)O(E) と思って差し支えないです。

[https://qiita.com/drken/items/dc53c683d6de8aeacf5a](url)

## 状態は遷移：「配る DP」と「貰う DP」

DP は**状態の遷移**を扱うが遷移の仕方には 2 通りがある．ここでは，from（`dp[from]`），to（`dp[to]`）という 2 状態（from -> to）を考える．

- 配る DP（集める DP）：? -> to

  - **to への遷移方法を考える**．前の状態（from，複数あり得る）が分かっているときに，次の遷移先の最適な状態を得たいときに使う．- DP テーブルの言葉を使うと，
  - 「**ノード i への遷移方法を考える**」
  - 「`dp[i-1]`，`dp[i-2]` の値（前の状態）が分かっているときに，`dp[i]` の値を更新する」．

- 貰う DP：from -> ?
  - **from からの遷移方法を考える**．
  - DP テーブルの言葉を使うと，
    - 「**ノード i からの遷移方法を考える**」
    - 「`dp[i]` の値（後の状態）が分かっているときに，その値を用いて，`dp[i+1]` や `dp[i+2]` の値を更新する」．

どちらも考え方は同じであり，DP に共通して重要なことは，

- ノード from からノード to への遷移を行うときは，`dp[from]` の更新は完了している

ということである．

## DP のコツ: 「再帰的な全探索」のイメージを磨こう！

DP に入門するためには、とにかく「**再帰的に全探索することのイメージを磨きあげる**」ことが重要だと言われます。たとえメモ化再帰ではなく、ボトムアップに for 文を回してテーブルを更新する DP を直接考えていたとしても、

- `dp[i]` には i 番目までの探索過程がまとめられている

ということの理解が重要だと思います (各書籍や wikipedia などで「部分構造最適性の利用」といった言葉でやたら難しく説明される部分ですね)．しばしば DP に対しては

- 全探索のメモ化としてとらえる
- 漸化式としてとらえる

の 2 つの大きな派閥に分かれる印象ですが，漸化式派も DP テーブルの各マス `dp[i]` に探索過程がまとめられているイメージを抱きながら問題を解いていると思うので，使い慣れている思考フォーマットが違うだけだと言えるでしょう．

まとめると、「再帰的な全探索」に対するイメージと勘の練度を高めて行くことが、DP を習得する上で重要だと思います。

## 貪欲と DP

貪欲でイケるというのは，「greedy でイケるという証明があって初めて成り立つもの」であるため，どういう場合で使い分けるかというよりは「証明ができるかどうか」で判断した方が良い．そうでなければ DP を使った方が無難．

例えば，「大きい方から取っていくのがなぜ最適なのかを証明できれば greedy で解いて良い」．
